= render "header"
.item-new-main
  .item-new-main__container
    %table.item-new-main__item-box
      %tr
        %td{rowspan: "2", class:"item-new-main__item-box__image"}
          = image_tag @item.imageurl, class: "item-new-main__item-box__image__content"
        %td
          %p 商品名
        %td
          %p 価格
      %tr
        %td.item-new-main__item-box__name
          = @item.name
          %br
          = link_to "商品購入ページ", @item.itemurl, target: :_blank
          - if user_signed_in?
            - if current_user.id == @item.user.id
              = link_to "お気に入り削除", "/items/#{@item.id}", method: :delete
        %td.item-new-main__item-box__price
          = "¥#{@item.price}円" 

    -if user_signed_in?
      .review-form
        = form_with model: [@item,@review], local: true, class: "new-form", id: "new-review" do |f|
          .new-form__name
            = f.label :title, "レビュータイトル"
            = f.text_field :title, id: 'review-title'
          .new-form__star
            .new-form__star-delicious{id: "star1"}
              = f.label :delicious, "おいしさ"
              = f.hidden_field :delicious, id: :review_star1
            .new-form__star-eazy{id: "star2"}
              = f.label :eazy, "手軽さ"
              = f.hidden_field :eazy, id: :review_star2
            .new-form__star-cost{id: "star3"}
              = f.label :cost, "コストパフォーマンス"
              = f.hidden_field :cost, id: :review_star3

          .new-form__review
            = f.label :content, "レビュー"
            = f.text_area :content, placeholder:'レビュー内容がなくても、タイトルと評価のみで投稿できます。まずは投稿してみましょう！', id: "review-content"
          .new-form__image
            = f.label :image, "画像"
            = f.file_field :image, id: "review-image"
          .new-form__submit
            = f.submit 'レビューを投稿する', class: "new-form__submit__btn", id: "new-submit"

    .review-container
      .review-container__box
        .review-container__box__title
          %p レビュー一覧
        - @reviews.each do |review|
          .review-container__box__content
            .review-container__box__content__box1
              .create-at
                = review.created_at.to_date
              .avater-box
                .avater
                  = image_tag "member_photo_noimage_thumb.png", width: "100px", height: "100px"
                .reviewer
                  = "#{review.user.nickname}"
              .review-conteiner__box__content__box1__average
                = "総合評価 : #{((review.delicious + review.eazy + review.cost) / 3).round(1)}点"
              .review-container__box__content__box1__title
                %p タイトル
                = review.title
              - if review.content.present?
                .review-container__box__content__box1__content
                  %p レビュー
                  = review.content
              .review-container__box__content__box1__image
                = image_tag "#{review.image}"
            .review-container__box__content__box2
              .review-container__box__content__box2__star
                %p おいしさ
                %div{id: "star-delicious#{review.id}"}
                %p 手軽さ
                %div{id: "star-eazy#{review.id}"}
                %p コストパフォーマンス
                %div{id: "star-cost#{review.id}"}

                :javascript
                  $('#star-delicious#{review.id}').raty({
                    size: 36,
                    starOff: "#{asset_path('star-off.png')}",
                    starOn: "#{asset_path('star-on.png')}",
                    starHalf: "#{asset_path('star-half.png')}",
                    half: true,
                    readOnly: true,
                    score: "#{review.delicious}"
                  });

                  $('#star-eazy#{review.id}').raty({
                    size: 36,
                    starOff: "#{asset_path('star-off.png')}",
                    starOn: "#{asset_path('star-on.png')}",
                    starHalf: "#{asset_path('star-half.png')}",
                    half: true,
                    readOnly: true,
                    score: "#{review.eazy}"
                  })

                  $('#star-cost#{review.id}').raty({
                    size: 36,
                    starOff: "#{asset_path('star-off.png')}",
                    starOn: "#{asset_path('star-on.png')}",
                    starHalf: "#{asset_path('star-half.png')}",
                    half: true,
                    readOnly: true,
                    score: "#{review.cost}"
                  })

              .review-container__box__destroy
                - if user_signed_in?
                  - if current_user.id == review.user.id
                    = link_to "レビュー削除", "/items/#{review.item_id}/reviews/#{review.id}", method: :delete


  = render 'shared/star'